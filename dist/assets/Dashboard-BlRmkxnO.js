import{c as N,r as x,j as e,A as k,u as z,C as S,R as P}from"./index-B_dDcTag.js";import{u as T,L as v,s as D,M as O,T as R,a as A,P as U,b as Z}from"./LoadingSpinner-Ca-9tSYO.js";import{M as _,F as B,g as E}from"./api-0fk011ha.js";import{A as F}from"./activity-D7iz2RVj.js";import{P as H}from"./plus-CN1x0aaZ.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=N("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=N("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]),W=({incidentCount:t,lastUpdate:a})=>{const[s,i]=x.useState(!1),[n,l]=x.useState(!1),[h,g]=x.useState(t);return x.useEffect(()=>{if(t>h){i(!0),l(!0);const c=setTimeout(()=>i(!1),1e3),m=setTimeout(()=>l(!1),3e3);return()=>{clearTimeout(c),clearTimeout(m)}}g(t)},[t,h]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`fixed top-4 right-4 z-50 flex items-center gap-3 px-4 py-2 
          bg-black/80 backdrop-blur-md rounded-full border border-red-500/50 
          shadow-lg shadow-red-500/10 transition-all duration-300
          ${s?"scale-105 border-red-400":"scale-100"}
        `,children:[e.jsxs("div",{className:"flex items-center gap-2 pr-3 border-r border-gray-600",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-red-500 rounded-full"}),e.jsx("div",{className:"absolute inset-0 w-2.5 h-2.5 bg-red-500 rounded-full animate-ping"})]}),e.jsx("span",{className:"text-red-500 font-bold text-sm tracking-wider",children:"LIVE"})]}),e.jsxs("div",{className:"flex items-center gap-2 pr-3 border-r border-gray-600",children:[e.jsx(F,{size:16,className:"text-blue-400"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:`text-xl font-bold text-white leading-none transition-all duration-300 ${s?"text-red-400 scale-110":""}`,children:t}),e.jsx("span",{className:"text-[10px] text-gray-500 uppercase tracking-wider",children:"Active"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(G,{size:14,className:"text-green-400"}),e.jsxs("div",{className:"flex items-end gap-0.5 h-4",children:[e.jsx("div",{className:"w-1 h-1 bg-green-500 rounded-sm animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-1 h-2 bg-green-500 rounded-sm animate-pulse",style:{animationDelay:"100ms"}}),e.jsx("div",{className:"w-1 h-3 bg-green-500 rounded-sm animate-pulse",style:{animationDelay:"200ms"}}),e.jsx("div",{className:"w-1 h-4 bg-green-400 rounded-sm animate-pulse",style:{animationDelay:"300ms"}})]})]})]}),n&&e.jsxs("div",{className:`fixed top-20 right-4 z-50 flex items-center gap-3 px-4 py-3 \r
            bg-gradient-to-r from-red-600 to-orange-600 rounded-lg shadow-xl \r
            animate-slide-in-right`,children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-full",children:e.jsx(k,{size:18,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-semibold text-sm",children:"New Incident Reported!"}),e.jsx("p",{className:"text-white/80 text-xs",children:"Real-time update received"})]})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes slide-in-right {
          from {
            opacity: 0;
            transform: translateX(100px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }
        .animate-slide-in-right {
          animation: slide-in-right 0.3s ease-out forwards;
        }
      `})]})};(function(){function t(a){return this instanceof t?(this._canvas=a=typeof a=="string"?document.getElementById(a):a,this._ctx=a.getContext("2d"),this._width=a.width,this._height=a.height,this._max=1,void this.clear()):new t(a)}t.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(a,s){return this._data=a,this},max:function(a){return this._max=a,this},add:function(a){return this._data.push(a),this},clear:function(){return this._data=[],this},radius:function(a,s){s=s||15;var i=this._circle=document.createElement("canvas"),n=i.getContext("2d"),l=this._r=a+s;return i.width=i.height=2*l,n.shadowOffsetX=n.shadowOffsetY=200,n.shadowBlur=s,n.shadowColor="black",n.beginPath(),n.arc(l-200,l-200,a,0,2*Math.PI,!0),n.closePath(),n.fill(),this},gradient:function(a){var s=document.createElement("canvas"),i=s.getContext("2d"),n=i.createLinearGradient(0,0,0,256);s.width=1,s.height=256;for(var l in a)n.addColorStop(l,a[l]);return i.fillStyle=n,i.fillRect(0,0,1,256),this._grad=i.getImageData(0,0,1,256).data,this},draw:function(a){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var s=this._ctx;s.clearRect(0,0,this._width,this._height);for(var i,n=0,l=this._data.length;l>n;n++)i=this._data[n],s.globalAlpha=Math.max(i[2]/this._max,a||.05),s.drawImage(this._circle,i[0]-this._r,i[1]-this._r);var h=s.getImageData(0,0,this._width,this._height);return this._colorize(h.data,this._grad),s.putImageData(h,0,0),this},_colorize:function(a,s){for(var i,n=3,l=a.length;l>n;n+=4)i=4*a[n],i&&(a[n-3]=s[i],a[n-2]=s[i+1],a[n-1]=s[i+2])}},window.simpleheat=t})(),L.HeatLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(t,a){this._latlngs=t,L.setOptions(this,a)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(t){return L.setOptions(this,t),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return!this._heat||this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),t._panes.overlayPane.appendChild(this._canvas),t.on("moveend",this._reset,this),t.options.zoomAnimation&&L.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._canvas),t.off("moveend",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var t=this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),a=L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);t.style[a]="50% 50%";var s=this._map.getSize();t.width=s.x,t.height=s.y;var i=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(t,"leaflet-zoom-"+(i?"animated":"hide")),this._heat=simpleheat(t),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t);var a=this._map.getSize();this._heat._width!==a.x&&(this._canvas.width=this._heat._width=a.x),this._heat._height!==a.y&&(this._canvas.height=this._heat._height=a.y),this._redraw()},_redraw:function(){var t,a,s,i,n,l,h,g,c,m=[],p=this._heat._r,b=this._map.getSize(),r=new L.Bounds(L.point([-p,-p]),b.add([p,p])),o=this.options.max===void 0?1:this.options.max,u=this.options.maxZoom===void 0?this._map.getMaxZoom():this.options.maxZoom,d=1/Math.pow(2,Math.max(0,Math.min(u-this._map.getZoom(),12))),y=p/2,f=[],w=this._map._getMapPanePos(),C=w.x%y,I=w.y%y;for(t=0,a=this._latlngs.length;a>t;t++)if(s=this._map.latLngToContainerPoint(this._latlngs[t]),r.contains(s)){n=Math.floor((s.x-C)/y)+2,l=Math.floor((s.y-I)/y)+2;var M=this._latlngs[t].alt!==void 0?this._latlngs[t].alt:this._latlngs[t][2]!==void 0?+this._latlngs[t][2]:1;c=M*d,f[l]=f[l]||[],i=f[l][n],i?(i[0]=(i[0]*i[2]+s.x*c)/(i[2]+c),i[1]=(i[1]*i[2]+s.y*c)/(i[2]+c),i[2]+=c):f[l][n]=[s.x,s.y,c]}for(t=0,a=f.length;a>t;t++)if(f[t])for(h=0,g=f[t].length;g>h;h++)i=f[t][h],i&&m.push([Math.round(i[0]),Math.round(i[1]),Math.min(i[2],o)]);this._heat.data(m).draw(this.options.minOpacity),this._frame=null},_animateZoom:function(t){var a=this._map.getZoomScale(t.zoom),s=this._map._getCenterOffset(t.center)._multiplyBy(-a).subtract(this._map._getMapPanePos());L.DomUtil.setTransform?L.DomUtil.setTransform(this._canvas,s,a):this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(s)+" scale("+a+")"}}),L.heatLayer=function(t,a){return new L.HeatLayer(t,a)};const X=({points:t,options:a={}})=>{const s=T();return x.useEffect(()=>{if(!s||!t||t.length===0)return;const i={radius:a.radius||25,blur:a.blur||15,maxZoom:a.maxZoom||17,max:a.max||1,minOpacity:a.minOpacity||.4,gradient:a.gradient||{.2:"#3b82f6",.4:"#22c55e",.6:"#eab308",.8:"#f97316",1:"#ef4444"}},n=v.heatLayer(t,i);return n.addTo(s),()=>{s.removeLayer(n)}},[s,t,a]),null},Y=({type:t="default",title:a,subtitle:s,actionLabel:i,actionPath:n,onAction:l,icon:h})=>{const g=z(),c={"no-incidents":{icon:S,title:"All Clear!",subtitle:"No active incidents at the moment. The community is safe.",actionLabel:"Report Incident",actionPath:"/report",iconColor:"text-green-500",iconBg:"bg-green-500/10"},"no-results":{icon:_,title:"No Results Found",subtitle:"Try adjusting your filters or search criteria.",actionLabel:"Clear Filters",iconColor:"text-blue-500",iconBg:"bg-blue-500/10"},error:{icon:k,title:"Something Went Wrong",subtitle:"Unable to load data. Please try again.",actionLabel:"Retry",iconColor:"text-red-500",iconBg:"bg-red-500/10"},default:{icon:_,title:"No Data",subtitle:"Nothing to display here yet.",actionLabel:null,iconColor:"text-gray-500",iconBg:"bg-gray-500/10"}},m=c[t]||c.default,p=h||m.icon,b=a||m.title,r=s||m.subtitle,o=i||m.actionLabel,u=n||m.actionPath,d=()=>{l?l():u&&g(u)};return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6 text-center",children:[e.jsx("div",{className:`w-20 h-20 ${m.iconBg} rounded-full flex items-center justify-center mb-6 animate-pulse`,children:e.jsx(p,{size:40,className:m.iconColor})}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:b}),e.jsx("p",{className:"text-gray-400 max-w-md mb-6",children:r}),o&&e.jsxs("button",{onClick:d,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-500 hover:to-orange-500 text-white font-medium rounded-xl transition-all hover:scale-105 shadow-lg shadow-red-500/20",children:[t==="error"?e.jsx(P,{size:18}):e.jsx(H,{size:18}),o]})]})};delete v.Icon.Default.prototype._getIconUrl;v.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const q=t=>{const s={Critical:"#ef4444",High:"#ef4444",Medium:"#f97316",Low:"#eab308"}[t]||"#3b82f6";return v.divIcon({className:"custom-marker",html:`
      <div class="relative">
        <div class="absolute inset-0 animate-ping rounded-full" style="background-color: ${s}; opacity: 0.4;"></div>
        <div class="relative w-6 h-6 rounded-full border-2 border-white shadow-lg" style="background-color: ${s};"></div>
      </div>
    `,iconSize:[24,24],iconAnchor:[12,12]})},j={Fire:"üî•",Accident:"üöó",Medical:"üè•",Crime:"üö®",Infrastructure:"üèóÔ∏è"},te=()=>{const[t,a]=x.useState([]),[s,i]=x.useState(!0),[n,l]=x.useState([]),[h,g]=x.useState(Date.now()),[c,m]=x.useState(!0),p=t.map(r=>{const u={Critical:1,High:.8,Medium:.5,Low:.3}[r.severity]||.5;return[r.location.lat,r.location.lng,u]});x.useEffect(()=>{(async()=>{try{const o=await E();a(o.incidents||[]),i(!1)}catch(o){console.error("Failed to fetch incidents:",o),i(!1)}})()},[]),x.useEffect(()=>{const r=D(o=>{if(o.type==="new_incident"){const u=o.data.incident;a(d=>[u,...d]),g(Date.now()),l(d=>[...d,u._id]),setTimeout(()=>{l(d=>d.filter(y=>y!==u._id))},1e3)}else o.type==="upvote_update"&&a(u=>u.map(d=>d._id===o.data.incidentId?{...d,upvotes:o.data.upvotes}:d))});return()=>r()},[]);const b=r=>({Critical:"bg-red-500 text-white",High:"bg-red-500 text-white",Medium:"bg-orange-500 text-white",Low:"bg-yellow-500 text-black"})[r]||"bg-blue-500 text-white";return e.jsxs("div",{className:"flex h-screen w-full overflow-hidden bg-gray-900",children:[e.jsx(W,{incidentCount:t.length,lastUpdate:h}),e.jsxs("div",{className:"w-[65%] h-full relative",children:[e.jsx("div",{className:"absolute top-4 left-4 z-[1000]",children:e.jsxs("button",{onClick:()=>m(!c),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all shadow-lg ${c?"bg-gradient-to-r from-red-600 to-orange-600 text-white":"bg-gray-800 text-gray-300 hover:bg-gray-700"}`,children:[c?e.jsx(B,{size:18}):e.jsx($,{size:18}),c?"Heatmap ON":"Heatmap OFF"]})}),s?e.jsx("div",{className:"flex items-center justify-center h-full bg-gray-800",children:e.jsx("div",{className:"text-white text-xl",children:"Loading map..."})}):e.jsxs(O,{center:[20.5937,78.9629],zoom:5,className:"h-full w-full",style:{background:"#1f2937"},children:[e.jsx(R,{attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),c&&p.length>0&&e.jsx(X,{points:p,options:{radius:30,blur:20,maxZoom:17,minOpacity:.4}}),t.map(r=>e.jsx(A,{position:[r.location.lat,r.location.lng],icon:q(r.severity),children:e.jsx(U,{children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:j[r.type]}),e.jsx("h3",{className:"font-bold text-lg",children:r.type})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:r.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${b(r.severity)}`,children:r.severity}),e.jsxs("span",{className:"text-sm font-medium",children:["üëç ",r.upvotes]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:new Date(r.timestamp).toLocaleString()})]})})},r._id))]})]}),e.jsxs("div",{className:"w-[35%] h-full bg-black/80 backdrop-blur-lg border-l border-gray-700 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:"Live Incidents"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:[t.length," active reports"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-transparent",children:s?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Z,{size:"lg",text:"Loading incidents..."})}):t.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Y,{type:"no-incidents"})}):t.map(r=>{var o;return e.jsxs("div",{className:`bg-gray-800/60 backdrop-blur rounded-lg p-4 border border-gray-700 hover:border-gray-600 transition-all ${n.includes(r._id)?"animate-slide-in-top":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-3xl",children:j[r.type]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold",children:r.type}),e.jsx("p",{className:"text-gray-400 text-xs",children:new Date(r.timestamp).toLocaleTimeString()})]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${b(r.severity)}`,children:r.severity})]}),e.jsx("p",{className:"text-gray-300 text-sm mb-3 line-clamp-2",children:r.description}),((o=r.ai_analysis)==null?void 0:o.tags)&&r.ai_analysis.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:r.ai_analysis.tags.slice(0,3).map((u,d)=>e.jsxs("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-300 text-xs rounded-full",children:["#",u]},d))}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("span",{className:"text-yellow-400 font-medium",children:r.status})]}),e.jsxs("div",{className:"flex items-center gap-1 text-white font-medium",children:[e.jsx("span",{children:"üëç"}),e.jsx("span",{children:r.upvotes})]})]})]},r._id)})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes slide-in-top {
          0% {
            transform: translateY(-20px);
            opacity: 0;
          }
          100% {
            transform: translateY(0);
            opacity: 1;
          }
        }
        
        .animate-slide-in-top {
          animation: slide-in-top 0.5s ease-out;
        }

        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }

        .scrollbar-thin::-webkit-scrollbar {
          width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
          background: transparent;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
          background: #374151;
          border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
          background: #4b5563;
        }
      `})]})};export{te as default};
